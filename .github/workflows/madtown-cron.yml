name: MADTOWN CLIPS Cron Jobs (Balanced Optimized)

on:
  schedule:
    # 🎥 新着動画取得（12時間ごと）
    - cron: "0 */12 * * *"

    # 🏷️ ハッシュタグ検索（1日1回）
    - cron: "30 9 * * *"

    # 🧩 ショート動画判定（毎時）
    - cron: "0 * * * *"

    # 📊 再生数・高評価更新（2時間ごと）
    - cron: "0 */2 * * *"

    # 🧹 削除チェック（毎日早朝3時）
    - cron: "0 3 * * *"

  workflow_dispatch: # 手動実行も可

jobs:
  run-crons:
    runs-on: ubuntu-latest

    steps:
      # ===============================
      # 🎥 新着動画取得（12時間ごと）
      # ===============================
      - name: 🎥 Fetch Videos Diff Batch 1（12時間ごと）
        run: |
          echo "Running fetch-videos-diff (Batch 1)..."
          curl -s -o /dev/null -w "%{http_code}\n" "https://madtown-clips.vercel.app/api/fetch-videos-diff?offset=0&limit=50"

      - name: 🎥 Fetch Videos Diff Batch 2
        run: |
          echo "Running fetch-videos-diff (Batch 2)..."
          curl -s -o /dev/null -w "%{http_code}\n" "https://madtown-clips.vercel.app/api/fetch-videos-diff?offset=50&limit=50"

      - name: 🎥 Fetch Videos Diff Batch 3
        run: |
          echo "Running fetch-videos-diff (Batch 3)..."
          curl -s -o /dev/null -w "%{http_code}\n" "https://madtown-clips.vercel.app/api/fetch-videos-diff?offset=100&limit=50"

      - name: 🎥 Fetch Videos Diff Batch 4
        run: |
          echo "Running fetch-videos-diff (Batch 4)..."
          curl -s -o /dev/null -w "%{http_code}\n" "https://madtown-clips.vercel.app/api/fetch-videos-diff?offset=150&limit=50"

      # ===============================
      # 🏷️ ハッシュタグ検索（1日1回）
      # ===============================
      - name: 🏷️ Fetch Videos by Hashtag（1日1回）
        run: |
          echo "Running fetch-videos-hashtag..."
          curl -s -o /dev/null -w "%{http_code}\n" "https://madtown-clips.vercel.app/api/fetch-videos-hashtag"

      # ===============================
      # 🧩 ショート動画判定（毎時）
      # ===============================
      - name: 🧩 Update Shorts（毎時）
        run: |
          echo "Running update-is-short-html..."
          curl -s -o /dev/null -w "%{http_code}\n" "https://madtown-clips.vercel.app/api/update-is-short-html"

      # ===============================
      # 📊 再生数・高評価更新（2時間ごと）
      # ===============================
      - name: 📊 Update Stats（2時間ごと）
        run: |
          echo "Running update-stats..."
          curl -s -o /dev/null -w "%{http_code}\n" "https://madtown-clips.vercel.app/api/update-stats"

      # ===============================
      # 🧹 削除チェック（毎日1回）
      # ===============================
      - name: 🧹 Cleanup Deleted Videos（毎日3時）
        run: |
          echo "Running cleanup-deleted-videos..."
          curl -s -o /dev/null -w "%{http_code}\n" "https://madtown-clips.vercel.app/api/cleanup-deleted-videos"
